{% extends 'base.html' %}
{% from 'components/sidebar.html' import sidebar %}
{% from 'components/header.html' import header %}
{% from 'components/ui_components.html' import stat_card, chart_card, data_table %}

{% block title %}Fees Management - Intelleva{% endblock %}

{% block content %}
<div class="flex h-screen bg-gray-100 dark:bg-gray-900">
    <!-- Sidebar -->
    {{ sidebar('student', 'fees') }}
    
    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden ml-0 md:ml-64 transition-all duration-300">
        <!-- Header -->
        {{ header('Fees Management', current_user.firstname, current_user.image_link) }}
        
        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-gray-100 dark:bg-gray-900 p-4 md:p-6">
            <!-- Page Header -->
            <div class="mb-6">
                <h1 class="text-2xl font-bold text-gray-800 dark:text-white">Fees Management</h1>
                <p class="text-gray-600 dark:text-gray-300 mt-1">View your fee details, payment history, and upcoming payments</p>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                {{ stat_card('credit-card', 'Total Fees', '$2,500', 'For current term', 'neutral') }}
                {{ stat_card('check-circle', 'Paid Amount', '$1,750', '70% of total fees', 'positive') }}
                {{ stat_card('alert-circle', 'Outstanding', '$750', 'Due in 15 days', 'warning') }}
                {{ stat_card('calendar', 'Next Due Date', 'Mar 30, 2025', 'Installment #3', 'neutral') }}
            </div>
            
            <!-- Payment Progress -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Payment Progress</h2>
                <div class="mb-4">
                    <div class="flex justify-between mb-1">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Current Term Payment (70%)</span>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">$1,750 / $2,500</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                        <div class="bg-teal-500 h-2.5 rounded-full" style="width: 70%"></div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-medium text-gray-700 dark:text-gray-300">Installment #1</h3>
                            <span class="badge badge-success">Paid</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Amount: $1,000</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Due Date: Jan 15, 2025</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Paid On: Jan 12, 2025</p>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-medium text-gray-700 dark:text-gray-300">Installment #2</h3>
                            <span class="badge badge-success">Paid</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Amount: $750</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Due Date: Feb 15, 2025</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Paid On: Feb 14, 2025</p>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border-2 border-teal-500 dark:border-teal-400">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-medium text-gray-700 dark:text-gray-300">Installment #3</h3>
                            <span class="badge badge-warning">Pending</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Amount: $750</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Due Date: Mar 30, 2025</p>
                        <div class="mt-3">
                            <button class="btn-primary py-1 px-4 w-full text-sm">
                                Pay Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Fee Structure -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Fee Structure (2024-2025)</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="intelleva-table">
                        <thead>
                            <tr>
                                <th>Fee Type</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Frequency</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Tuition Fee</td>
                                <td>Regular academic instruction fees</td>
                                <td>$1,800</td>
                                <td>Per Term</td>
                                <td>
                                    <div class="flex items-center">
                                        <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mr-2">
                                            <div class="h-full bg-teal-500" style="width: 70%"></div>
                                        </div>
                                        <span class="text-sm">70%</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Laboratory Fee</td>
                                <td>Science and computer lab usage</td>
                                <td>$300</td>
                                <td>Per Term</td>
                                <td>
                                    <div class="flex items-center">
                                        <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mr-2">
                                            <div class="h-full bg-teal-500" style="width: 70%"></div>
                                        </div>
                                        <span class="text-sm">70%</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Library Fee</td>
                                <td>Access to library resources</td>
                                <td>$150</td>
                                <td>Per Term</td>
                                <td>
                                    <div class="flex items-center">
                                        <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mr-2">
                                            <div class="h-full bg-teal-500" style="width: 70%"></div>
                                        </div>
                                        <span class="text-sm">70%</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Technology Fee</td>
                                <td>IT infrastructure and services</td>
                                <td>$200</td>
                                <td>Per Term</td>
                                <td>
                                    <div class="flex items-center">
                                        <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mr-2">
                                            <div class="h-full bg-teal-500" style="width: 70%"></div>
                                        </div>
                                        <span class="text-sm">70%</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Extracurricular Fee</td>
                                <td>Clubs and activities</td>
                                <td>$50</td>
                                <td>Per Term</td>
                                <td>
                                    <div class="flex items-center">
                                        <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mr-2">
                                            <div class="h-full bg-teal-500" style="width: 70%"></div>
                                        </div>
                                        <span class="text-sm">70%</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="bg-gray-50 dark:bg-gray-700">
                                <td colspan="2" class="font-semibold text-right">Total</td>
                                <td class="font-semibold">$2,500</td>
                                <td>Per Term</td>
                                <td>
                                    <div class="flex items-center">
                                        <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mr-2">
                                            <div class="h-full bg-teal-500" style="width: 70%"></div>
                                        </div>
                                        <span class="text-sm font-semibold">70%</span>
                                    </div>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            
            <!-- Payment History -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-6">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Payment History</h2>
                    <button class="btn-outline py-1 px-3 text-sm flex items-center">
                        <i data-lucide="download" class="w-4 h-4 mr-1"></i>
                        Download Receipts
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="intelleva-table">
                        <thead>
                            <tr>
                                <th>Receipt #</th>
                                <th>Date</th>
                                <th>Payment Method</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <span class="font-medium">INV-2025-001</span>
                                </td>
                                <td>Jan 12, 2025</td>
                                <td>Credit Card</td>
                                <td>First Term Fees - Installment #1</td>
                                <td>$1,000</td>
                                <td><span class="badge badge-success">Completed</span></td>
                                <td>
                                    <button class="text-teal-600 dark:text-teal-400 hover:text-teal-800 dark:hover:text-teal-300 mr-2">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                        <i data-lucide="download" class="w-4 h-4"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span class="font-medium">INV-2025-015</span>
                                </td>
                                <td>Feb 14, 2025</td>
                                <td>Bank Transfer</td>
                                <td>First Term Fees - Installment #2</td>
                                <td>$750</td>
                                <td><span class="badge badge-success">Completed</span></td>
                                <td>
                                    <button class="text-teal-600 dark:text-teal-400 hover:text-teal-800 dark:hover:text-teal-300 mr-2">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                        <i data-lucide="download" class="w-4 h-4"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span class="font-medium">INV-2025-032</span>
                                </td>
                                <td>Mar 30, 2025</td>
                                <td>Pending</td>
                                <td>First Term Fees - Installment #3</td>
                                <td>$750</td>
                                <td><span class="badge badge-warning">Pending</span></td>
                                <td>
                                    <button class="text-teal-600 dark:text-teal-400 hover:text-teal-800 dark:hover:text-teal-300 mr-2">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button class="text-gray-400 dark:text-gray-500 cursor-not-allowed">
                                        <i data-lucide="download" class="w-4 h-4"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                        <div class="text-sm text-gray-500 dark:text-gray-400 mb-4 sm:mb-0">
                            Showing <span class="font-medium">1</span> to <span class="font-medium">3</span> of <span class="font-medium">3</span> payments
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="btn-outline py-1 px-3 text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                Previous
                            </button>
                            <button class="btn-outline py-1 px-3 text-sm bg-teal-50 dark:bg-teal-900 text-teal-600 dark:text-teal-400 border-teal-500 dark:border-teal-400">
                                1
                            </button>
                            <button class="btn-outline py-1 px-3 text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Make a Payment -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Make a Payment</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <form id="paymentForm">
                            <div class="form-group mb-4">
                                <label for="paymentAmount">Payment Amount</label>
                                <input type="text" id="paymentAmount" name="paymentAmount" class="form-input" value="$750.00" readonly>
                            </div>
                            
                            <div class="form-group mb-4">
                                <label for="paymentMethod">Payment Method</label>
                                <select id="paymentMethod" name="paymentMethod" class="form-select">
                                    <option value="card">Credit/Debit Card</option>
                                    <option value="bank">Bank Transfer</option>
                                    <option value="mobile">Mobile Money</option>
                                </select>
                            </div>
                            
                            <div id="cardDetails" class="space-y-4">
                                <div class="form-group">
                                    <label for="cardNumber">Card Number</label>
                                    <input type="text" id="cardNumber" name="cardNumber" class="form-input" placeholder="1234 5678 9012 3456">
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="form-group">
                                        <label for="expiryDate">Expiry Date</label>
                                        <input type="text" id="expiryDate" name="expiryDate" class="form-input" placeholder="MM/YY">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="cvv">CVV</label>
                                        <input type="text" id="cvv" name="cvv" class="form-input" placeholder="123">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="cardName">Name on Card</label>
                                    <input type="text" id="cardName" name="cardName" class="form-input" placeholder="John Doe">
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <button type="submit" class="btn-primary py-2 px-4 w-full flex items-center justify-center">
                                    <i data-lucide="credit-card" class="w-4 h-4 mr-2"></i>
                                    Pay $750.00 Now
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-6 rounded-lg">
                        <h3 class="font-medium text-gray-800 dark:text-white mb-4">Payment Summary</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-300">Installment #3</span>
                                <span class="text-gray-800 dark:text-white">$750.00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-300">Processing Fee</span>
                                <span class="text-gray-800 dark:text-white">$0.00</span>
                            </div>
                            <div class="border-t border-gray-200 dark:border-gray-600 pt-3 mt-3">
                                <div class="flex justify-between font-semibold">
                                    <span class="text-gray-800 dark:text-white">Total</span>
                                    <span class="text-gray-800 dark:text-white">$750.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 space-y-4">
                            <div class="flex items-start">
                                <i data-lucide="info" class="w-5 h-5 text-blue-500 mr-2 mt-0.5"></i>
                                <p class="text-sm text-gray-600 dark:text-gray-300">
                                    This payment will complete your fee obligations for the current term.
                                </p>
                            </div>
                            <div class="flex items-start">
                                <i data-lucide="shield" class="w-5 h-5 text-teal-500 mr-2 mt-0.5"></i>
                                <p class="text-sm text-gray-600 dark:text-gray-300">
                                    All payments are secured with industry-standard encryption. Your card details are never stored on our servers.
                                </p>
                            </div>
                            <div class="flex items-start">
                                <i data-lucide="help-circle" class="w-5 h-5 text-gray-500 mr-2 mt-0.5"></i>
                                <p class="text-sm text-gray-600 dark:text-gray-300">
                                    Need help with your payment? Contact the finance office at <a href="mailto:finance@intelleva-academy.edu" class="text-teal-600 dark:text-teal-400 hover:underline">finance@intelleva-academy.edu</a> or call +1 (555) 123-4567.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/lucide@latest"></script>
<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons();
        
        // Payment method change handler
        const paymentMethod = document.getElementById('paymentMethod');
        const cardDetails = document.getElementById('cardDetails');
        
        if (paymentMethod && cardDetails) {
            paymentMethod.addEventListener('change', function() {
                if (this.value === 'card') {
                    cardDetails.classList.remove('hidden');
                } else {
                    cardDetails.classList.add('hidden');
                }
            });
        }
        
        // Payment form submission
        const paymentForm = document.getElementById('paymentForm');
        
        if (paymentForm) {
            paymentForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // In a real implementation, this would integrate with Paystack
                // For demo purposes, we'll just show an alert
                alert('Payment processing is in demo mode. In a production environment, this would redirect to Paystack for payment processing.');
                
                // Example of how Paystack would be integrated
                /*
                payWithPaystack();
                
                function payWithPaystack() {
                    let handler = PaystackPop.setup({
                        key: 'pk_test_xxxxxxxxxx', // Replace with your public key
                        email: 'j.doe@student.intelleva-academy.edu',
                        amount: 75000, // Amount in kobo (750 USD * 100)
                        currency: 'USD',
                        ref: 'INV-2025-032-' + Math.floor((Math.random() * 1000000000) + 1),
                        callback: function(response) {
                            // Handle successful payment
                            window.location.href = '/payment/success?reference=' + response.reference;
                        },
                        onClose: function() {
                            // Handle payment window close
                            alert('Payment window closed.');
                        }
                    });
                    handler.openIframe();
                }
                */
            });
        }
    });
</script>
{% endblock %}
