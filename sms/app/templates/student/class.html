{% extends 'base.html' %}
{% from 'components/sidebar.html' import sidebar %}
{% from 'components/header.html' import header %}
{% from 'components/ui_components.html' import stat_card, chart_card, data_table %}

{% block title %}Class Information - Intelleva{% endblock %}

{% block content %}
<div class="flex h-screen bg-gray-100 dark:bg-gray-900">
    <!-- Sidebar -->
    {{ sidebar('student', 'class') }}
    
    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden ml-0 md:ml-64 transition-all duration-300">
        <!-- Header -->
        {{ header('Class Information', current_user.firstname, current_user.image_link) }}
        
        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-gray-100 dark:bg-gray-900 p-4 md:p-6">
            <!-- Page Header -->
            <div class="mb-6">
                <h1 class="text-2xl font-bold text-gray-800 dark:text-white">Class Information</h1>
                <p class="text-gray-600 dark:text-gray-300 mt-1">View class schedules, teacher details, and classmates</p>
            </div>
            
            <!-- Class Overview -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex flex-col md:flex-row">
                    <div class="md:w-1/4 mb-4 md:mb-0 flex justify-center">
                        <div class="w-32 h-32 bg-teal-100 dark:bg-teal-900/30 rounded-full flex items-center justify-center">
                            <span class="text-4xl font-bold text-teal-600 dark:text-teal-400">10A</span>
                        </div>
                    </div>
                    <div class="md:w-3/4 md:pl-6">
                        <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-2">Grade 10-A (Science Stream)</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-gray-600 dark:text-gray-400 flex items-center">
                                    <i data-lucide="users" class="w-4 h-4 mr-2"></i>
                                    <span>30 Students (18 Boys, 12 Girls)</span>
                                </p>
                                <p class="text-gray-600 dark:text-gray-400 flex items-center mt-2">
                                    <i data-lucide="user" class="w-4 h-4 mr-2"></i>
                                    <span>Class Teacher: Mr. Robert Johnson</span>
                                </p>
                                <p class="text-gray-600 dark:text-gray-400 flex items-center mt-2">
                                    <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                                    <span>Room: Science Block, Room 203</span>
                                </p>
                            </div>
                            <div>
                                <p class="text-gray-600 dark:text-gray-400 flex items-center">
                                    <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                                    <span>Academic Year: 2024-2025</span>
                                </p>
                                <p class="text-gray-600 dark:text-gray-400 flex items-center mt-2">
                                    <i data-lucide="award" class="w-4 h-4 mr-2"></i>
                                    <span>Class Rank: 2nd (School-wide)</span>
                                </p>
                                <p class="text-gray-600 dark:text-gray-400 flex items-center mt-2">
                                    <i data-lucide="trending-up" class="w-4 h-4 mr-2"></i>
                                    <span>Average GPA: 3.65</span>
                                </p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="flex items-center">
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300 mr-2">Class Performance:</span>
                                <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-teal-500 to-green-500" style="width: 85%"></div>
                                </div>
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300 ml-2">85%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Textbooks and Learning Materials Section -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Textbooks & Learning Materials</h2>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    {{ stat_card('book', 'Required Textbooks', required_textbooks|default(8, true)|string, 'For current term', 'neutral') }}
                    {{ stat_card('check-circle', 'Purchased', purchased_textbooks|default(5, true)|string, '{:.0f}%'.format(textbook_percentage|default(62.5, true)) + ' of required books', 'positive') }}
                    {{ stat_card('alert-circle', 'Pending Purchase', pending_textbooks|default(3, true)|string, 'Recommended soon', 'warning') }}
                </div>
                
                <!-- Textbooks List -->
                <div class="overflow-x-auto">
                    <table class="intelleva-table">
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Textbook Title</th>
                                <th>Author</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for textbook in textbooks|default([
                                {'subject': 'Mathematics', 'title': 'Advanced Mathematics for Science Students', 'author': 'Dr. Alan Smith', 'price': 3500, 'status': 'purchased', 'purchase_date': 'Jan 15, 2025'},
                                {'subject': 'Physics', 'title': 'Principles of Physics', 'author': 'Prof. Richard Miller', 'price': 4200, 'status': 'purchased', 'purchase_date': 'Jan 16, 2025'},
                                {'subject': 'Chemistry', 'title': 'Modern Chemistry', 'author': 'Dr. Sarah Johnson', 'price': 3800, 'status': 'purchased', 'purchase_date': 'Jan 18, 2025'},
                                {'subject': 'Biology', 'title': 'Biology: The Science of Life', 'author': 'Dr. Michael Brown', 'price': 4000, 'status': 'purchased', 'purchase_date': 'Feb 2, 2025'},
                                {'subject': 'English', 'title': 'Advanced English Grammar & Composition', 'author': 'Prof. Elizabeth Taylor', 'price': 3000, 'status': 'purchased', 'purchase_date': 'Feb 5, 2025'},
                                {'subject': 'Computer Science', 'title': 'Introduction to Programming with Python', 'author': 'Dr. James Wilson', 'price': 4500, 'status': 'pending', 'purchase_date': None},
                                {'subject': 'Economics', 'title': 'Principles of Economics', 'author': 'Prof. Robert Davis', 'price': 3200, 'status': 'pending', 'purchase_date': None},
                                {'subject': 'History', 'title': 'World History: Modern Era', 'author': 'Dr. Patricia Moore', 'price': 2800, 'status': 'pending', 'purchase_date': None}
                            ], true) %}
                            <tr>
                                <td>{{ textbook.subject }}</td>
                                <td>{{ textbook.title }}</td>
                                <td>{{ textbook.author }}</td>
                                <td>â‚¦{{ '{:,.2f}'.format(textbook.price) }}</td>
                                <td>
                                    {% if textbook.status == 'purchased' %}
                                    <span class="badge badge-success">Purchased</span>
                                    <div class="text-xs text-gray-500">{{ textbook.purchase_date }}</div>
                                    {% else %}
                                    <span class="badge badge-warning">Pending</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if textbook.status == 'pending' %}
                                    <button class="btn-sm btn-primary" onclick="purchaseTextbook('{{ current_user.id }}', '{{ textbook.subject }}', '{{ textbook.title }}', {{ textbook.price }})">
                                        Purchase
                                    </button>
                                    {% else %}
                                    <button class="btn-sm btn-outline" onclick="viewTextbookReceipt('{{ textbook.subject }}')">
                                        <i class="icon icon-file-text mr-1"></i> Receipt
                                    </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Additional Learning Materials -->
                <div class="mt-8">
                    <h3 class="text-md font-semibold text-gray-800 dark:text-white mb-4">Additional Learning Materials</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {% for material in learning_materials|default([
                            {'name': 'Science Laboratory Kit', 'description': 'Essential equipment for physics and chemistry experiments', 'price': 8500, 'status': 'optional'},
                            {'name': 'Graphing Calculator', 'description': 'Required for advanced mathematics and physics', 'price': 12000, 'status': 'recommended'},
                            {'name': 'Digital Learning Subscription', 'description': 'Online resources and practice tests', 'price': 5000, 'status': 'recommended'},
                            {'name': 'Language Learning Software', 'description': 'Interactive language learning tools', 'price': 3500, 'status': 'optional'},
                            {'name': 'Art Supplies Kit', 'description': 'Complete set of art supplies for creative projects', 'price': 4500, 'status': 'optional'},
                            {'name': 'Programming Software License', 'description': 'Professional IDE for computer science class', 'price': 7500, 'status': 'recommended'}
                        ], true) %}
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-medium text-gray-800 dark:text-white">{{ material.name }}</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">{{ material.description }}</p>
                                    <p class="text-sm font-medium text-gray-800 dark:text-white mt-2">â‚¦{{ '{:,.2f}'.format(material.price) }}</p>
                                </div>
                                <span class="badge badge-{{ 'info' if material.status == 'recommended' else 'neutral' }}">
                                    {{ material.status|title }}
                                </span>
                            </div>
                            <div class="mt-4">
                                <button class="btn-sm btn-primary w-full" onclick="purchaseLearningMaterial('{{ current_user.id }}', '{{ material.name }}', {{ material.price }})">
                                    Purchase
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <!-- Class Schedule -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Weekly Class Schedule</h2>
                <div class="overflow-x-auto">
                    <table class="intelleva-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Monday</th>
                                <th>Tuesday</th>
                                <th>Wednesday</th>
                                <th>Thursday</th>
                                <th>Friday</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 1st Period -->
                            <tr>
                                <td class="font-medium">8:00 - 9:30</td>
                                <td class="bg-teal-50 dark:bg-teal-900/20">
                                    <div class="font-medium">Mathematics</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mr. Johnson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Room 203</div>
                                </td>
                                <td class="bg-blue-50 dark:bg-blue-900/20">
                                    <div class="font-medium">Physics</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Ms. Williams</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 101</div>
                                </td>
                                <td class="bg-teal-50 dark:bg-teal-900/20">
                                    <div class="font-medium">Mathematics</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mr. Johnson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Room 203</div>
                                </td>
                                <td class="bg-blue-50 dark:bg-blue-900/20">
                                    <div class="font-medium">Physics</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Ms. Williams</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 101</div>
                                </td>
                                <td class="bg-teal-50 dark:bg-teal-900/20">
                                    <div class="font-medium">Mathematics</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mr. Johnson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Room 203</div>
                                </td>
                            </tr>
                            
                            <!-- 2nd Period -->
                            <tr>
                                <td class="font-medium">9:45 - 11:15</td>
                                <td class="bg-purple-50 dark:bg-purple-900/20">
                                    <div class="font-medium">Chemistry</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Dr. Martinez</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 102</div>
                                </td>
                                <td class="bg-pink-50 dark:bg-pink-900/20">
                                    <div class="font-medium">English</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mrs. Davis</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Room 205</div>
                                </td>
                                <td class="bg-purple-50 dark:bg-purple-900/20">
                                    <div class="font-medium">Chemistry</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Dr. Martinez</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 102</div>
                                </td>
                                <td class="bg-pink-50 dark:bg-pink-900/20">
                                    <div class="font-medium">English</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mrs. Davis</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Room 205</div>
                                </td>
                                <td class="bg-purple-50 dark:bg-purple-900/20">
                                    <div class="font-medium">Chemistry</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Dr. Martinez</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 102</div>
                                </td>
                            </tr>
                            
                            <!-- Lunch Break -->
                            <tr>
                                <td class="font-medium">11:15 - 12:00</td>
                                <td colspan="5" class="bg-gray-50 dark:bg-gray-700 text-center">
                                    <div class="font-medium">Lunch Break</div>
                                </td>
                            </tr>
                            
                            <!-- 3rd Period -->
                            <tr>
                                <td class="font-medium">12:00 - 1:30</td>
                                <td class="bg-green-50 dark:bg-green-900/20">
                                    <div class="font-medium">Biology</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mrs. Thompson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 103</div>
                                </td>
                                <td class="bg-yellow-50 dark:bg-yellow-900/20">
                                    <div class="font-medium">History</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mr. Anderson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Room 207</div>
                                </td>
                                <td class="bg-green-50 dark:bg-green-900/20">
                                    <div class="font-medium">Biology</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mrs. Thompson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 103</div>
                                </td>
                                <td class="bg-yellow-50 dark:bg-yellow-900/20">
                                    <div class="font-medium">History</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mr. Anderson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Room 207</div>
                                </td>
                                <td class="bg-green-50 dark:bg-green-900/20">
                                    <div class="font-medium">Biology</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mrs. Thompson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 103</div>
                                </td>
                            </tr>
                            
                            <!-- 4th Period -->
                            <tr>
                                <td class="font-medium">1:45 - 3:15</td>
                                <td class="bg-indigo-50 dark:bg-indigo-900/20">
                                    <div class="font-medium">Computer Science</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mr. Wilson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 201</div>
                                </td>
                                <td class="bg-red-50 dark:bg-red-900/20">
                                    <div class="font-medium">Economics</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Ms. Roberts</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Room 208</div>
                                </td>
                                <td class="bg-indigo-50 dark:bg-indigo-900/20">
                                    <div class="font-medium">Computer Science</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Mr. Wilson</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Lab 201</div>
                                </td>
                                <td class="bg-red-50 dark:bg-red-900/20">
                                    <div class="font-medium">Economics</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Ms. Roberts</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Room 208</div>
                                </td>
                                <td class="bg-gray-50 dark:bg-gray-700">
                                    <div class="font-medium">Free Period</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Study Hall</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Library</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Classmates -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Classmates</h2>
                    <div class="relative">
                        <input type="text" placeholder="Search classmates..." class="form-control pr-8">
                        <i data-lucide="search" class="w-4 h-4 absolute right-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Classmate 1 -->
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg flex items-center">
                        <div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mr-4">
                            <span class="text-lg font-semibold text-blue-600 dark:text-blue-400">JD</span>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800 dark:text-white">John Doe</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Student ID: S12345</p>
                        </div>
                    </div>
                    
                    <!-- Classmate 2 -->
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg flex items-center">
                        <div class="w-12 h-12 rounded-full bg-pink-100 dark:bg-pink-900/30 flex items-center justify-center mr-4">
                            <span class="text-lg font-semibold text-pink-600 dark:text-pink-400">JS</span>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800 dark:text-white">Jane Smith</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Student ID: S12346</p>
                        </div>
                    </div>
                    
                    <!-- Classmate 3 -->
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg flex items-center">
                        <div class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center mr-4">
                            <span class="text-lg font-semibold text-green-600 dark:text-green-400">MJ</span>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800 dark:text-white">Michael Johnson</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Student ID: S12347</p>
                        </div>
                    </div>
                    
                    <!-- Classmate 4 -->
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg flex items-center">
                        <div class="w-12 h-12 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center mr-4">
                            <span class="text-lg font-semibold text-purple-600 dark:text-purple-400">EW</span>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800 dark:text-white">Emily Williams</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Student ID: S12348</p>
                        </div>
                    </div>
                    
                    <!-- Classmate 5 -->
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg flex items-center">
                        <div class="w-12 h-12 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center mr-4">
                            <span class="text-lg font-semibold text-yellow-600 dark:text-yellow-400">DB</span>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800 dark:text-white">David Brown</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Student ID: S12349</p>
                        </div>
                    </div>
                    
                    <!-- Classmate 6 -->
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg flex items-center">
                        <div class="w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center mr-4">
                            <span class="text-lg font-semibold text-red-600 dark:text-red-400">SL</span>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-800 dark:text-white">Sarah Lee</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Student ID: S12350</p>
                        </div>
                    </div>
                </div>
                <div class="mt-4 flex justify-center">
                    <button class="btn-outline">
                        View All Classmates
                    </button>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Textbook Purchase Modal -->
<div id="textbookModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Purchase Textbook</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <div class="mb-4">
                <h3 id="textbookTitle" class="text-lg font-semibold mb-1"></h3>
                <p id="textbookSubject" class="text-sm text-gray-600"></p>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4">
                <div class="flex justify-between mb-2">
                    <span>Price:</span>
                    <span id="textbookPrice" class="font-semibold"></span>
                </div>
                <div class="flex justify-between">
                    <span>Payment Method:</span>
                    <span>Paystack</span>
                </div>
            </div>
            <div class="form-group">
                <label for="deliveryOption">Delivery Option</label>
                <select id="deliveryOption" class="form-control">
                    <option value="school">Deliver to School</option>
                    <option value="home">Deliver to Home Address</option>
                    <option value="pickup">Pickup from Bookstore</option>
                </select>
            </div>
            <button id="confirmPurchaseBtn" class="btn-primary w-full mt-4">Confirm Purchase</button>
        </div>
    </div>
</div>

<!-- Learning Material Purchase Modal -->
<div id="materialModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Purchase Learning Material</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <div class="mb-4">
                <h3 id="materialName" class="text-lg font-semibold mb-1"></h3>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4">
                <div class="flex justify-between mb-2">
                    <span>Price:</span>
                    <span id="materialPrice" class="font-semibold"></span>
                </div>
                <div class="flex justify-between">
                    <span>Payment Method:</span>
                    <span>Paystack</span>
                </div>
            </div>
            <div class="form-group">
                <label for="materialDeliveryOption">Delivery Option</label>
                <select id="materialDeliveryOption" class="form-control">
                    <option value="school">Deliver to School</option>
                    <option value="home">Deliver to Home Address</option>
                    <option value="pickup">Pickup from Store</option>
                </select>
            </div>
            <button id="confirmMaterialPurchaseBtn" class="btn-primary w-full mt-4">Confirm Purchase</button>
        </div>
    </div>
</div>

<!-- Receipt Modal -->
<div id="receiptModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Purchase Receipt</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body" id="receiptContent">
            <!-- Receipt content will be loaded here -->
        </div>
        <div class="modal-footer">
            <button class="btn-outline" onclick="printReceipt()">
                <i class="icon icon-printer mr-1"></i> Print
            </button>
            <button class="btn-primary" onclick="downloadReceipt()">
                <i class="icon icon-download mr-1"></i> Download
            </button>
        </div>
    </div>
</div>

<script>
    // Purchase textbook
    function purchaseTextbook(studentId, subject, title, price) {
        // Set modal content
        document.getElementById('textbookTitle').textContent = title;
        document.getElementById('textbookSubject').textContent = subject;
        document.getElementById('textbookPrice').textContent = 'â‚¦' + price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        
        // Show modal
        const modal = document.getElementById('textbookModal');
        modal.style.display = 'block';
        
        // Close modal when clicking on X
        const closeBtn = modal.querySelector('.close');
        closeBtn.onclick = function() {
            modal.style.display = 'none';
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        
        // Handle confirm button click
        document.getElementById('confirmPurchaseBtn').onclick = function() {
            const deliveryOption = document.getElementById('deliveryOption').value;
            
            // Prepare payment data
            const paymentData = {
                student_id: studentId,
                amount: price,
                payment_type: 'textbook',
                description: `Textbook: ${title} (${subject})`,
                metadata: {
                    textbook_title: title,
                    subject: subject,
                    delivery_option: deliveryOption
                }
            };
            
            // Close modal
            modal.style.display = 'none';
            
            // Send payment request to server
            fetch('/payment/initiate-student-payment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(paymentData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status) {
                    // Redirect to payment page
                    window.location.href = data.data.authorization_url;
                } else {
                    alert('Payment initialization failed: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while processing your payment. Please try again.');
            });
        }
    }
    
    // Purchase learning material
    function purchaseLearningMaterial(studentId, materialName, price) {
        // Set modal content
        document.getElementById('materialName').textContent = materialName;
        document.getElementById('materialPrice').textContent = 'â‚¦' + price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        
        // Show modal
        const modal = document.getElementById('materialModal');
        modal.style.display = 'block';
        
        // Close modal when clicking on X
        const closeBtn = modal.querySelector('.close');
        closeBtn.onclick = function() {
            modal.style.display = 'none';
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        
        // Handle confirm button click
        document.getElementById('confirmMaterialPurchaseBtn').onclick = function() {
            const deliveryOption = document.getElementById('materialDeliveryOption').value;
            
            // Prepare payment data
            const paymentData = {
                student_id: studentId,
                amount: price,
                payment_type: 'learning_material',
                description: `Learning Material: ${materialName}`,
                metadata: {
                    material_name: materialName,
                    delivery_option: deliveryOption
                }
            };
            
            // Close modal
            modal.style.display = 'none';
            
            // Send payment request to server
            fetch('/payment/initiate-student-payment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(paymentData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status) {
                    // Redirect to payment page
                    window.location.href = data.data.authorization_url;
                } else {
                    alert('Payment initialization failed: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while processing your payment. Please try again.');
            });
        }
    }
    
    // View textbook receipt
    function viewTextbookReceipt(subject) {
        // In a real implementation, this would fetch the receipt from the server
        // For now, we'll just show a sample receipt
        
        const receiptHTML = `
            <div class="p-4">
                <div class="text-center mb-4">
                    <h3 class="text-xl font-bold">Intelleva School</h3>
                    <p>Textbook Purchase Receipt</p>
                </div>
                
                <div class="border-t border-b border-gray-200 dark:border-gray-700 py-4 mb-4">
                    <div class="flex justify-between mb-2">
                        <span class="font-medium">Subject:</span>
                        <span>${subject}</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="font-medium">Purchase Date:</span>
                        <span>Feb 5, 2025</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="font-medium">Transaction ID:</span>
                        <span>TXN-${Math.random().toString(36).substring(2, 10).toUpperCase()}</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="font-medium">Payment Method:</span>
                        <span>Paystack</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between font-bold">
                        <span>Total Amount:</span>
                        <span>â‚¦4,200.00</span>
                    </div>
                </div>
                
                <div class="text-center text-sm text-gray-500 mt-6">
                    <p>Thank you for your purchase!</p>
                    <p>For any questions, please contact the school administration.</p>
                </div>
            </div>
        `;
        
        // Set receipt content
        document.getElementById('receiptContent').innerHTML = receiptHTML;
        
        // Show modal
        const modal = document.getElementById('receiptModal');
        modal.style.display = 'block';
        
        // Close modal when clicking on X
        const closeBtn = modal.querySelector('.close');
        closeBtn.onclick = function() {
            modal.style.display = 'none';
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    }
    
    // Print receipt
    function printReceipt() {
        const printContents = document.getElementById('receiptContent').innerHTML;
        const originalContents = document.body.innerHTML;
        
        document.body.innerHTML = `
            <div style="padding: 20px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h1>Intelleva School Management System</h1>
                    <h2>Textbook Purchase Receipt</h2>
                </div>
                ${printContents}
            </div>
        `;
        
        window.print();
        document.body.innerHTML = originalContents;
        
        // Reattach event listeners
        attachEventListeners();
    }
    
    // Download receipt
    function downloadReceipt() {
        // Implementation would depend on server-side functionality
        alert('Receipt download functionality will be implemented on the server side.');
    }
    
    // Attach all event listeners
    function attachEventListeners() {
        // Re-attach event listeners for modals
        const modals = document.querySelectorAll('.modal');
        const closeBtns = document.querySelectorAll('.close');
        
        for (let i = 0; i < closeBtns.length; i++) {
            closeBtns[i].onclick = function() {
                modals[i].style.display = 'none';
            }
        }
        
        window.onclick = function(event) {
            for (let i = 0; i < modals.length; i++) {
                if (event.target == modals[i]) {
                    modals[i].style.display = 'none';
                }
            }
        }
    }
</script>
{% endblock %}
